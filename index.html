<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Previsão do tempo</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <style>
            html, body {
               width: 100%;
               height: 100%;
               margin: 0;
               padding: 0;
}
            .cabecalho {
               background-image: url('tempo.jpg');
               background-repeat: repeat-x;                    
            
            }

        </style>
    </head>
    <body>
        <div class="cabecalho">

        </div>
        <div class="formulario">
              <form>
           
                   <label for="cidade">Cidade:</label>
                   <input type="text" class="form-control" id="cidade" name="cidade">
            
            
                   <button type="button" class="btn btn-primary">Pesquisar</button>

              </form>

        </div>
        <div id="carregar" style="display: none;">
            Carregando...
        </div>

        <div class="resultado"  id="resultado" style="display: none;">

        </div>

    </body>
    <script>
        

        document.querySelector('button').addEventListener('click', function(){

            startCarregar();

            var cidade = document.getElementById('cidade').value;
            console.log(cidade);
            var chamadaApi = 'https://api.openweathermap.org/data/2.5/weather?q='+ cidade + '&appid=83a9db599874d9f5683e2016c92ae339';
            
            axios.get(chamadaApi).then(function(res){
                mostraResultado(res.data);
                var nome = res.data.name;
                var pais = res.data.country;
                var descricao = res.data.weather[0].description;
                var icon = res.data.weather[0].icon;
                var iconurl = "http://openweathermap.org/img/w/" + icon + ".png";
                console.log(descricao);

            }).catch(error => {
                    // console.log(error)
 
                    // Mostra a div com o erro
                    document.getElementById('error').style.display = 'block'
 
                    // Mostra a mensagem
                    document.getElementById('error').innerHTML = 'Erro inesperado'
                })
                .finally(() => endCarregar ())

        });

        function mostraResultado (address) {
    
             document.getElementById('resultado').style.display = "block";
 
             // Mostra os resultados:
             document.getElementById('resultado').innerHTML = `
                 <p><b>Cidade: </b> ${address.name}</p>
                 <p><b>País: </b> ${address.sys.country}</p>
                 <p><b>Descrição </b> ${address.weather[0].description} </p>
                 <img src= "http://openweathermap.org/img/w/" + ${address.weather[0].icon} + ".png">
    `
}

     function startCarregar () {
         // Exibe a div de carregamento
         document.getElementById('carregar').style.display = 'block'
     }
 
     function endCarregar () {
         // Oculta a div de carregamento
         document.getElementById('carregar').style.display = 'none'
     }


    </script>
</html>